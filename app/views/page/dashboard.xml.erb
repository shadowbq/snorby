<?xml version="1.0"?>
<snorby dashboard_xml="1.0">
	<time>
		<now><%=@now%></now>
		<cache><%=@last_cache%></cache>
		<range><%=@range%></range>
	</time>
	
	<events><%=@event_count%></events>
	<metrics>
		<sources>
                <% xml_string = ""
                @src_metrics.each{|k,v| xml_string << "<src>\n<ip>#{k}</ip>\n<count>#{v}</count>\n</src>" }
                %>
                <%=raw xml_string%>
                </sources>
                <destinations>
                <% xml_string = ""
                @dst_metrics.each{|k,v| xml_string << "<dst>\n<ip>#{k}</ip>\n<count>#{v}</count>\n</dst>" }
                %>
                <%=raw xml_string%>
                </destinations>
		
		<tcp><%=@tcp.sum%></tcp>
		<udp><%=@udp.sum%></udp>
		<icmp><%=@icmp.sum%></icmp>
	</metrics>
	<severities>
		<high><%=@high.sum%></high>
		<medium><%=@medium.sum%></medium>
		<low><%=@low.sum%></low>
	</severities>
	<sensors>
        <% @sensors.each do |sensor| %>
	        <sensor>
			<name><%=raw sensor.name %></name>
			<count><%= sensor.events_count %></count>
	        </sensor>
	<% end %>  
	</sensors>  
	<sensor_metrics><![CDATA[
		<%=raw @sensor_metrics%>
		]]>
       </sensor_metrics>
       <signatures>
                <% xml_string = ""
                @signature_metrics.each{|k,v| xml_string << "<signature>\n<name>#{k}</name>\n<count>#{v}</count>\n</signature>" }
                %>
                <%=raw xml_string%>
        </signatures>
        <classifications>
        <% @classifications.each do |classification| %>
          <classification>
            <name><%= classification.name %></name>
            <count><%= classification.events_count %></count>
          </classification>
        <% end %>
        </classifications>

</snorby>
