<% content_for :footer do %>

	<script type="text/javascript">
		
		$(document).ready(function(){
		  // jQuery selector for elements with a specific class attribute.
		  // Here, there is one div with the class "chart2"
		  
		  <%
		  i = 0;
		  @ticks = @sensor_metrics[0][:range].collect { |ticks| i = i+1; [i, ticks.gsub("'","").to_i] }
		  
		  i = 0;
		  @sensor_metrics.each { |sensor| %>
		  	var s<%= i %> = <%= sensor[:data] %>; 
		  <%
		    i = i + 1;
		  }
		  @series = ""
		  i.times { |a|    
            @series = @series + "s#{a}, "
		    }
		  @series.chomp!(", ")   
		  %>
		  		  
		  var ticks = <%= @ticks %>;
		 
		  $("#events-graph").jqplot ([<%= @series %> ], {
		      title: "Event Count vs Time By Sensor",
		      series:[
		        <% @sensor_metrics.each {|sensor| %> 
		        {label:'<%= sensor[:name] %>'}, 
		        <% } %>
		        
		        ],
		      axesDefaults: {
		        labelRenderer: $.jqplot.CanvasAxisLabelRenderer
		      },
		      seriesDefaults: {
		          rendererOptions: {
		              smooth: true
		          }
		      },
		      highlighter: {
			       show: true,
			       sizeAdjust: 9.5
			  },
			  grid: { drawGridlines: true },
			  cursor: { show: true, zoom:true },
		      legend: { show:true, location: 'e' },
		      axes: {
		        xaxis: {
		        	tickOptions:{ showGridline:false},	 
		        	ticks: ticks,
		        	pad: 0,
				<% if (@range == 'year' || @range == 'quarter') %>
					label: 'Month of Year'
				<% elsif (@range == 'month' || @range == 'last_month') %>
					label: 'Date of Month'
				<% elsif (@range == 'week' || @range == 'last_week') %>
					label: 'Date Of Week'
				<% elsif @range == 'last_24' %>
  					label: 'Last 24 Hours'
				<% else %>
					label: 'Hour of Day'
				<% end %>
		          
		        },
		        yaxis: {
		                 	
		          label: 'Event Count'
		        }
		      }
		    });
		});
		
		
		
		
		
	</script>

<% end %>

<div id='events-graph' class='dashboard-graph'></div>
